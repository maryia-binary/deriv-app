"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[903],{33026:(e,t,n)=>{n.r(t),n.d(t,{default:()=>A});var r=n(68461),i=n(68722),a=n(59472),o=n(44850),l=n(32735),c=n(40841),u=n.n(c),s=n(61055),d=n(22568);function f(){return f=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},f.apply(this,arguments)}function m(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,o,l=[],c=!0,u=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=a.call(n)).done)&&(l.push(r.value),l.length!==t);c=!0);}catch(e){u=!0,i=e}finally{try{if(!c&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw i}}return l}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return _(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}const p=function(e){var t=m(l.useState(!1),2),n=t[0],a=t[1],o=l.useRef(null);return(0,r.useOnClickOutside)(o,(function(){return a(!1)}),(function(e){var t,n=null==e?void 0:e.target;return"A"===n.tagName?(null==e||e.stopPropagation(),!1):!(null!==(t=o.current)&&void 0!==t&&t.contains(n))})),l.createElement("div",{ref:o},l.createElement(r.Popover,f({},e,{data_testid:"dt_form-field-info__popover",className:"form-field-info__popover",icon:"info",disable_message_icon:!0,zIndex:"9999",is_open:n,onClick:function(){return a((function(e){return!e}))},alignment:(0,i.isMobile)()?"left":"right"})))};var y=n(44166);function b(){return b=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},b.apply(this,arguments)}const v=function(e){var t=e.label,n=e.name,i=e.required,o=void 0!==i&&i,c=e.disabled,u=void 0!==c&&c,d=e.list_items,f=e.onItemSelection,m=e.placeholder,_=e.list_height,p=(0,a.useStore)().ui.is_mobile,y=function(e,t){return function(n){var r=n.value,i=n.text;t(e,r?i:"",!0)}};return l.createElement(s.Field,{name:n},(function(e){var n=e.field,i=e.meta,a=i.touched,c=i.error,s=e.form.setFieldValue;return l.createElement(l.Fragment,null,p?l.createElement(r.SelectNative,b({},n,{list_items:d,label:t,required:o,disabled:u,error:a?c:void 0,use_text:!0,"data-testid":"dt_".concat(n.name)})):l.createElement(r.Autocomplete,b({},n,{disabled:u,label:t,list_items:d,placeholder:m,required:o,"data-lpignore":"true",autoComplete:"off",error:a?c:void 0,onItemSelection:null!=f?f:y(n.name,s),"data-testid":"dt_".concat(n.name),list_height:_})))}))};function g(e){return g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},g(e)}function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function E(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach((function(t){x(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function x(e,t,n){return(t=function(e){var t=function(e,t){if("object"!==g(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==g(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===g(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var O=function(e){var t,n,r=e.account_settings,a=e.residence_list,c=e.required_fields,u=e.with_input_types,s=void 0!==u&&u,d=function(e,t,n){var r,i,a,c,u,s,d=function(t){var n;return null==e||null===(n=e.immutable_fields)||void 0===n?void 0:n.includes(t)},f=function(e){return n.includes(e)};return{place_of_birth:{label:l.createElement(o.Localize,{i18n_default_text:"Place of birth{{required}}",values:{required:f("place_of_birth")?"*":""}}),type:"select",initial_value:null!==(r=e.place_of_birth&&(null===(i=t.find((function(t){return t.value===e.place_of_birth})))||void 0===i?void 0:i.text))&&void 0!==r?r:"",disabled:d("place_of_birth"),required:f("place_of_birth"),list_items:t,rules:[["req",l.createElement(o.Localize,{key:"place_of_birth",i18n_default_text:"Place of birth is required."})]]},tax_residence:{label:l.createElement(o.Localize,{i18n_default_text:"Tax residence{{required}}",values:{required:f("tax_residence")?"*":""}}),type:"select",initial_value:null!==(a=e.tax_residence&&(null===(c=t.find((function(t){return t.value===e.tax_residence})))||void 0===c?void 0:c.text))&&void 0!==a?a:"",disabled:d("tax_residence"),required:f("tax_residence"),list_items:t,rules:[]},tax_identification_number:{label:l.createElement(o.Localize,{i18n_default_text:"Tax Identification number{{required}}",values:{required:f("tax_identification_number")?"*":""}}),type:"text",initial_value:null!==(u=e.tax_identification_number)&&void 0!==u?u:"",disabled:d("tax_identification_number"),required:f("tax_identification_number"),rules:[["length",l.createElement(o.Localize,{key:"TIN",i18n_default_text:"Tax Identification Number can't be longer than 25 characters."}),{min:0,max:25}],[function(e){return!e||RegExp(/^(?!^$|\s+)[A-Za-z0-9./\s-]{0,25}$/).test(e)},(0,o.localize)("Letters, numbers, spaces, periods, hyphens and forward slashes only.")],[function(e,t,n){var r=n.tax_residence;return!e||!!r},l.createElement(o.Localize,{key:"TIN",i18n_default_text:"Please fill in tax residence."})],[function(e,n,r){var i,a=r.tax_residence,o=null===(i=t.find((function(e){return e.text===a&&e.tin_format})))||void 0===i?void 0:i.tin_format;return!e||!o||o.some((function(t){return new RegExp(t).test(e)}))},l.createElement(o.Localize,{key:"TIN",i18n_default_text:"Tax Identification Number is invalid."})]]},account_opening_reason:{label:l.createElement(o.Localize,{i18n_default_text:"Intended use of account{{required}}",values:{required:f("account_opening_reason")?"*":""}}),type:"select",initial_value:null!==(s=e.account_opening_reason)&&void 0!==s?s:"",disabled:d("account_opening_reason"),required:f("account_opening_reason"),list_items:[{text:(0,o.localize)("Hedging"),value:"Hedging"},{text:(0,o.localize)("Income Earning"),value:"Income Earning"},{text:(0,o.localize)("Speculative"),value:"Speculative"}],rules:[["req",l.createElement(o.Localize,{key:"account_opening_reason",i18n_default_text:"Intended use of account is required."})]]}}}(r,a,c),f={};return Object.keys(d).forEach((function(e){f[e]=function(e,t,n){var r=e[t],i=r.label,a=r.placeholder,o=r.required,l=r.disabled,c=r.type,u=r.list_items;return E(E(E({name:t,label:i,required:o,disabled:l},n?{type:c}:{}),a?{placeholder:a}:{}),u?{list_items:u}:{})}(d,e,s)})),{fields:f,validate:(0,i.generateValidationFunction)("",d),initialValues:(t=d,n={},Object.keys(t).forEach((function(e){n[e]=t[e].initial_value})),n)}};function S(){return S=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},S.apply(this,arguments)}var k=function(){return l.createElement(r.Text,{as:"p",size:"s",line_height:"xxl",align:(0,i.isMobile)()?"left":"center",className:"additional-kyc-info-modal__form--header"},l.createElement(o.Localize,{i18n_default_text:"Please take a moment to update your information now."}))},j=(0,a.observer)((function(e){var t=e.setError,n=(0,a.useStore)(),i=n.client,c=n.ui,f=n.notifications,m=i.residence_list,_=i.updateAccountStatus,b=(0,d.useSettings)(),g=b.update,h=b.mutation,E=h.isLoading,x=h.error,j=h.status,w=b.data,I=b.isLoading,N=O({account_settings:w,residence_list:m,required_fields:["place_of_birth","account_opening_reason"]}),q=N.fields,z=N.initialValues,P=N.validate;return l.useEffect((function(){"success"===j?(_(),f.refreshNotifications(),c.toggleAdditionalKycInfoModal(),c.toggleKycInformationSubmittedModal()):"error"===j&&(null==t||t(x))}),[x,f,t,j,c,_]),I?l.createElement(r.Loading,{is_fullscreen:!1}):l.createElement(s.Formik,{validateOnMount:!0,validateOnBlur:!0,validateOnChange:!0,initialValues:z,onSubmit:function(e){var t,n={place_of_birth:null==m||null===(t=m.find((function(t){return t.text===e.place_of_birth})))||void 0===t?void 0:t.value,account_opening_reason:e.account_opening_reason};if(e.tax_identification_number&&(n.tax_identification_number=e.tax_identification_number),e.tax_residence){var r,i=null==m||null===(r=m.find((function(t){return t.text===e.tax_residence})))||void 0===r?void 0:r.value;n.tax_residence=i}g(n)},validate:P},(function(e){var t=e.isValid,n=e.setFieldValue;return l.createElement(s.Form,{className:"additional-kyc-info-modal__form-layout"},E?l.createElement(r.Loading,{is_fullscreen:!1}):l.createElement("section",{className:"additional-kyc-info-modal__form-layout--fields"},l.createElement(k,null),l.createElement("fieldset",{className:"additional-kyc-info-modal__form-field"},l.createElement(v,q.place_of_birth)),l.createElement("fieldset",{className:u()("additional-kyc-info-modal__form-field","additional-kyc-info-modal__form-field--info")},l.createElement(v,q.tax_residence),l.createElement(p,{message:l.createElement(o.Localize,{i18n_default_text:"The country in which you meet the criteria for paying taxes. Usually the country in which you physically reside."})})),l.createElement("fieldset",{className:"additional-kyc-info-modal__form-field--info"},l.createElement(y.C,S({},q.tax_identification_number,{data_testId:"dt_tax_identification_number"})),l.createElement(p,{message:l.createElement(o.Localize,{i18n_default_text:"Don't know your tax identification number? <1 />Click <0>here</0> to learn more.",components:[l.createElement("a",{key:0,className:"link",target:"_blank",rel:"noopener noreferrer",href:"https://www.oecd.org/tax/automatic-exchange/crs-implementation-and-assistance/tax-identification-numbers/"}),l.createElement("br",{key:1})]})})),l.createElement("fieldset",{className:"additional-kyc-info-modal__form-field"},l.createElement(v,S({onItemSelection:function(e){var t=e.value;n("account_opening_reason",void 0===t?"":t,!0)},list_height:"6rem"},q.account_opening_reason)))),l.createElement(r.Modal.Footer,{has_separator:!0,className:"additional-kyc-info-modal__form-action"},l.createElement(r.Button,{large:!0,primary:!0,type:"submit",disabled:!t||E},l.createElement(o.Localize,{i18n_default_text:"Submit"}))))}))}));j.displayName="AdditionalKycInfoForm";const w=j;function I(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,o,l=[],c=!0,u=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=a.call(n)).done)&&(l.push(r.value),l.length!==t);c=!0);}catch(e){u=!0,i=e}finally{try{if(!c&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw i}}return l}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return N(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return N(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function N(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function q(e){return q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},q(e)}var z=function(e){var t=e.error,n=e.setError;return l.createElement(l.Fragment,null,!!t&&l.createElement(r.InlineMessage,{size:"sm",message:t&&"object"===q(t)&&"message"in t&&"string"==typeof t.message&&t.message,type:"error"}),l.createElement(w,{setError:n}))},P=(0,a.observer)((function(){var e=(0,a.useStore)().ui,t=e.is_additional_kyc_info_modal_open,n=e.toggleAdditionalKycInfoModal,c=I(l.useState(""),2),u=c[0],s=c[1],d=(0,i.getPlatformSettings)("mt5"),f=function(){return l.createElement(o.Localize,{i18n_default_text:"Additional information required for {{platform}} account(s)",values:{platform:d.name}})};return l.createElement(l.Suspense,{fallback:l.createElement(r.UILoader,null)},l.createElement("div",{className:"additional-kyc-info-modal__container"},l.createElement(r.DesktopWrapper,null,l.createElement(r.Modal,{has_close_icon:!0,is_open:t,title:l.createElement(f,null),toggleModal:function(e){"A"===(null==e?void 0:e.target).tagName&&(null==e||e.stopPropagation()),n()},className:"additional-kyc-info",width:"90.4rem",height:u?"54.4rem":"49.6rem"},l.createElement(r.Modal.Body,{className:"additional-kyc-info-modal__form"},l.createElement(z,{setError:s,error:u})))),l.createElement(r.MobileWrapper,null,l.createElement(r.PageOverlay,{is_open:!0,portal_id:"deriv_app",header:l.createElement(r.Text,{as:"p",size:"xs",weight:"bold"},l.createElement(f,null)),onClickClose:n,header_classname:"additional-kyc-info-modal__portal-header"},l.createElement(r.Div100vhContainer,{className:"additional-kyc-info-modal__form",height_offset:"100px"},l.createElement(z,null))))))}));P.displayName="AdditionalKycInfoModal";const A=P}}]);
//# sourceMappingURL=core.additional-kyc-info-modal.cef86bb32b80c1b26e2f.js.map